name: VS Code Marketplace Release

on:
    release:
        types: [published]

jobs:
    publish-release:
        if: '!github.event.release.prerelease'
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: 'latest'
            - run: npm run clean-install
            - run: npm run build
            - run: npm install -g @vscode/vsce
            - run: vsce publish --pat ${{ secrets.VS_MARKETPLACE_TOKEN }}

    publish-prerelease:
        if: 'github.event.release.prerelease'
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: 'latest'
            - run: npm run clean-install
            - run: npm run build
            - run: npm install -g @vscode/vsce
            - run: vsce publish --pat ${{ secrets.VS_MARKETPLACE_TOKEN }} --pre-release
